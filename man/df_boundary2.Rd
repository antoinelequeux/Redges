% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/df_boundary2.R
\name{df_boundary2}
\alias{df_boundary2}
\title{Calcule la distribution d'une espèce et identifie ses bordures sur un raster (version 2)}
\usage{
df_boundary2(
  input_raster_path,
  species_points_list,
  dbf_path,
  species_name,
  percentage_threshold = 20,
  difference_threshold = 10
)
}
\arguments{
\item{input_raster_path}{Caractère. Chemin vers le fichier raster principal.}

\item{species_points_list}{Liste. Liste contenant pour chaque espèce ses points spatiaux (objets compatibles avec \code{terra}, par exemple des \code{SpatVector}).}

\item{dbf_path}{Caractère. Chemin vers le fichier .dbf fournissant des informations complémentaires sur l'espèce.}

\item{species_name}{Caractère. Nom de l'espèce à traiter.}

\item{percentage_threshold}{Numérique. Seuil de pourcentage pour identifier les bordures (cellules ayant une valeur supérieure à ce seuil et inférieure ou égale à 100). Par défaut, \code{20}.}

\item{difference_threshold}{Numérique. Seuil de différence entre le pourcentage d'eau et le pourcentage d'espèce pour ajuster la couleur. Par défaut, \code{10}.}
}
\value{
Un \code{data.frame} contenant les informations sur les bordures, incluant :
\itemize{
  \item les coordonnées (\code{x} et \code{y}),
  \item le pourcentage de terre (\code{PERCENTAGEWATER}),
  \item le pourcentage de l'espèce (\code{SPECIES_PERCENTAGE}),
  \item la différence entre ces deux pourcentages (\code{difference}),
  \item la couleur associée à la cellule (\code{color}).
}
}
\description{
Cette fonction charge un raster principal (en conservant les coordonnées en nombres réels), fusionne ses données avec une liste de points
correspondant à une espèce, et identifie les bordures vertes et rouges selon des seuils définis. Les informations issues d'un fichier DBF sont ensuite
ajoutées pour enrichir les données. La fonction calcule enfin la différence entre le pourcentage d'eau et le pourcentage de présence de l'espèce,
et ajuste la couleur associée à chaque cellule en fonction d'un seuil de différence.
}
\details{
La fonction procède en dix étapes :
\enumerate{
  \item Charger le raster principal et le convertir en \code{data.frame} en conservant les coordonnées réelles.
  \item Fusionner les points de l'espèce avec le \code{data.frame} du raster à l'aide de la colonne \code{PageName}.
        \code{merged_grid} contient toutes les lignes du raster (même celles sans correspondance), tandis que \code{merged_area} ne conserve
        que les correspondances exactes.
  \item Remplacer les valeurs manquantes de la colonne \code{PERCENTAGE} par 0.
  \item Construire un objet \code{SpatRaster} à partir des colonnes \code{x}, \code{y} et \code{PERCENTAGE} pour faciliter la recherche des cellules adjacentes.
  \item Identifier les bordures vertes : les cellules dont la valeur est supérieure au seuil (mais inférieure ou égale à 100) et dont les cellules adjacentes ont une valeur de 0.
  \item Identifier les bordures rouges : les cellules dont la valeur est comprise entre 0 et le seuil, puis repérer, parmi leurs voisines, celles qui valent 0.
  \item Construire deux \code{data.frame} (pour les bordures rouges et vertes) et les combiner.
  \item Joindre le \code{data.frame} combiné au \code{data.frame} du raster afin de récupérer des informations complémentaires (par exemple, la colonne \code{PageName}).
  \item Enrichir ces données en les fusionnant avec celles issues du fichier DBF (via la colonne \code{PageName}), puis renommer la colonne \code{PERCENTAGE} en \code{PERCENTAGEWATER}.
  \item Fusionner avec \code{merged_grid} pour ajouter la colonne \code{SPECIES_PERCENTAGE}, calculer la différence absolue entre \code{PERCENTAGEWATER} et \code{SPECIES_PERCENTAGE}
        et ajuster la couleur en fonction du seuil de différence.
}
}
\examples{
\dontrun{
  result <- df_boundary2(
    input_raster_path = "path/to/raster.tif",
    species_points_list = species_points_list,
    dbf_path = "path/to/species.dbf",
    species_name = "Lynx lynx",
    percentage_threshold = 20,
    difference_threshold = 10
  )
  head(result)
}

}
